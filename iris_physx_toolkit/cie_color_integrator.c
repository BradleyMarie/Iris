/*++

Copyright (c) 2020 Brad Weinberger

Module Name:

    cie_color_integrator.c

Abstract:

    Implements a CIE color integrator.

--*/

#include <stdalign.h>

#include "iris_physx_toolkit/cie_color_integrator.h"

//
// Defines
//

#define NUM_CIE_SAMPLES 471

//
// Static Data
//

static const float_t cie_wavelengths[] = {
    (float_t)360.0,
    (float_t)361.0,
    (float_t)362.0,
    (float_t)363.0,
    (float_t)364.0,
    (float_t)365.0,
    (float_t)366.0,
    (float_t)367.0,
    (float_t)368.0,
    (float_t)369.0,
    (float_t)370.0,
    (float_t)371.0,
    (float_t)372.0,
    (float_t)373.0,
    (float_t)374.0,
    (float_t)375.0,
    (float_t)376.0,
    (float_t)377.0,
    (float_t)378.0,
    (float_t)379.0,
    (float_t)380.0,
    (float_t)381.0,
    (float_t)382.0,
    (float_t)383.0,
    (float_t)384.0,
    (float_t)385.0,
    (float_t)386.0,
    (float_t)387.0,
    (float_t)388.0,
    (float_t)389.0,
    (float_t)390.0,
    (float_t)391.0,
    (float_t)392.0,
    (float_t)393.0,
    (float_t)394.0,
    (float_t)395.0,
    (float_t)396.0,
    (float_t)397.0,
    (float_t)398.0,
    (float_t)399.0,
    (float_t)400.0,
    (float_t)401.0,
    (float_t)402.0,
    (float_t)403.0,
    (float_t)404.0,
    (float_t)405.0,
    (float_t)406.0,
    (float_t)407.0,
    (float_t)408.0,
    (float_t)409.0,
    (float_t)410.0,
    (float_t)411.0,
    (float_t)412.0,
    (float_t)413.0,
    (float_t)414.0,
    (float_t)415.0,
    (float_t)416.0,
    (float_t)417.0,
    (float_t)418.0,
    (float_t)419.0,
    (float_t)420.0,
    (float_t)421.0,
    (float_t)422.0,
    (float_t)423.0,
    (float_t)424.0,
    (float_t)425.0,
    (float_t)426.0,
    (float_t)427.0,
    (float_t)428.0,
    (float_t)429.0,
    (float_t)430.0,
    (float_t)431.0,
    (float_t)432.0,
    (float_t)433.0,
    (float_t)434.0,
    (float_t)435.0,
    (float_t)436.0,
    (float_t)437.0,
    (float_t)438.0,
    (float_t)439.0,
    (float_t)440.0,
    (float_t)441.0,
    (float_t)442.0,
    (float_t)443.0,
    (float_t)444.0,
    (float_t)445.0,
    (float_t)446.0,
    (float_t)447.0,
    (float_t)448.0,
    (float_t)449.0,
    (float_t)450.0,
    (float_t)451.0,
    (float_t)452.0,
    (float_t)453.0,
    (float_t)454.0,
    (float_t)455.0,
    (float_t)456.0,
    (float_t)457.0,
    (float_t)458.0,
    (float_t)459.0,
    (float_t)460.0,
    (float_t)461.0,
    (float_t)462.0,
    (float_t)463.0,
    (float_t)464.0,
    (float_t)465.0,
    (float_t)466.0,
    (float_t)467.0,
    (float_t)468.0,
    (float_t)469.0,
    (float_t)470.0,
    (float_t)471.0,
    (float_t)472.0,
    (float_t)473.0,
    (float_t)474.0,
    (float_t)475.0,
    (float_t)476.0,
    (float_t)477.0,
    (float_t)478.0,
    (float_t)479.0,
    (float_t)480.0,
    (float_t)481.0,
    (float_t)482.0,
    (float_t)483.0,
    (float_t)484.0,
    (float_t)485.0,
    (float_t)486.0,
    (float_t)487.0,
    (float_t)488.0,
    (float_t)489.0,
    (float_t)490.0,
    (float_t)491.0,
    (float_t)492.0,
    (float_t)493.0,
    (float_t)494.0,
    (float_t)495.0,
    (float_t)496.0,
    (float_t)497.0,
    (float_t)498.0,
    (float_t)499.0,
    (float_t)500.0,
    (float_t)501.0,
    (float_t)502.0,
    (float_t)503.0,
    (float_t)504.0,
    (float_t)505.0,
    (float_t)506.0,
    (float_t)507.0,
    (float_t)508.0,
    (float_t)509.0,
    (float_t)510.0,
    (float_t)511.0,
    (float_t)512.0,
    (float_t)513.0,
    (float_t)514.0,
    (float_t)515.0,
    (float_t)516.0,
    (float_t)517.0,
    (float_t)518.0,
    (float_t)519.0,
    (float_t)520.0,
    (float_t)521.0,
    (float_t)522.0,
    (float_t)523.0,
    (float_t)524.0,
    (float_t)525.0,
    (float_t)526.0,
    (float_t)527.0,
    (float_t)528.0,
    (float_t)529.0,
    (float_t)530.0,
    (float_t)531.0,
    (float_t)532.0,
    (float_t)533.0,
    (float_t)534.0,
    (float_t)535.0,
    (float_t)536.0,
    (float_t)537.0,
    (float_t)538.0,
    (float_t)539.0,
    (float_t)540.0,
    (float_t)541.0,
    (float_t)542.0,
    (float_t)543.0,
    (float_t)544.0,
    (float_t)545.0,
    (float_t)546.0,
    (float_t)547.0,
    (float_t)548.0,
    (float_t)549.0,
    (float_t)550.0,
    (float_t)551.0,
    (float_t)552.0,
    (float_t)553.0,
    (float_t)554.0,
    (float_t)555.0,
    (float_t)556.0,
    (float_t)557.0,
    (float_t)558.0,
    (float_t)559.0,
    (float_t)560.0,
    (float_t)561.0,
    (float_t)562.0,
    (float_t)563.0,
    (float_t)564.0,
    (float_t)565.0,
    (float_t)566.0,
    (float_t)567.0,
    (float_t)568.0,
    (float_t)569.0,
    (float_t)570.0,
    (float_t)571.0,
    (float_t)572.0,
    (float_t)573.0,
    (float_t)574.0,
    (float_t)575.0,
    (float_t)576.0,
    (float_t)577.0,
    (float_t)578.0,
    (float_t)579.0,
    (float_t)580.0,
    (float_t)581.0,
    (float_t)582.0,
    (float_t)583.0,
    (float_t)584.0,
    (float_t)585.0,
    (float_t)586.0,
    (float_t)587.0,
    (float_t)588.0,
    (float_t)589.0,
    (float_t)590.0,
    (float_t)591.0,
    (float_t)592.0,
    (float_t)593.0,
    (float_t)594.0,
    (float_t)595.0,
    (float_t)596.0,
    (float_t)597.0,
    (float_t)598.0,
    (float_t)599.0,
    (float_t)600.0,
    (float_t)601.0,
    (float_t)602.0,
    (float_t)603.0,
    (float_t)604.0,
    (float_t)605.0,
    (float_t)606.0,
    (float_t)607.0,
    (float_t)608.0,
    (float_t)609.0,
    (float_t)610.0,
    (float_t)611.0,
    (float_t)612.0,
    (float_t)613.0,
    (float_t)614.0,
    (float_t)615.0,
    (float_t)616.0,
    (float_t)617.0,
    (float_t)618.0,
    (float_t)619.0,
    (float_t)620.0,
    (float_t)621.0,
    (float_t)622.0,
    (float_t)623.0,
    (float_t)624.0,
    (float_t)625.0,
    (float_t)626.0,
    (float_t)627.0,
    (float_t)628.0,
    (float_t)629.0,
    (float_t)630.0,
    (float_t)631.0,
    (float_t)632.0,
    (float_t)633.0,
    (float_t)634.0,
    (float_t)635.0,
    (float_t)636.0,
    (float_t)637.0,
    (float_t)638.0,
    (float_t)639.0,
    (float_t)640.0,
    (float_t)641.0,
    (float_t)642.0,
    (float_t)643.0,
    (float_t)644.0,
    (float_t)645.0,
    (float_t)646.0,
    (float_t)647.0,
    (float_t)648.0,
    (float_t)649.0,
    (float_t)650.0,
    (float_t)651.0,
    (float_t)652.0,
    (float_t)653.0,
    (float_t)654.0,
    (float_t)655.0,
    (float_t)656.0,
    (float_t)657.0,
    (float_t)658.0,
    (float_t)659.0,
    (float_t)660.0,
    (float_t)661.0,
    (float_t)662.0,
    (float_t)663.0,
    (float_t)664.0,
    (float_t)665.0,
    (float_t)666.0,
    (float_t)667.0,
    (float_t)668.0,
    (float_t)669.0,
    (float_t)670.0,
    (float_t)671.0,
    (float_t)672.0,
    (float_t)673.0,
    (float_t)674.0,
    (float_t)675.0,
    (float_t)676.0,
    (float_t)677.0,
    (float_t)678.0,
    (float_t)679.0,
    (float_t)680.0,
    (float_t)681.0,
    (float_t)682.0,
    (float_t)683.0,
    (float_t)684.0,
    (float_t)685.0,
    (float_t)686.0,
    (float_t)687.0,
    (float_t)688.0,
    (float_t)689.0,
    (float_t)690.0,
    (float_t)691.0,
    (float_t)692.0,
    (float_t)693.0,
    (float_t)694.0,
    (float_t)695.0,
    (float_t)696.0,
    (float_t)697.0,
    (float_t)698.0,
    (float_t)699.0,
    (float_t)700.0,
    (float_t)701.0,
    (float_t)702.0,
    (float_t)703.0,
    (float_t)704.0,
    (float_t)705.0,
    (float_t)706.0,
    (float_t)707.0,
    (float_t)708.0,
    (float_t)709.0,
    (float_t)710.0,
    (float_t)711.0,
    (float_t)712.0,
    (float_t)713.0,
    (float_t)714.0,
    (float_t)715.0,
    (float_t)716.0,
    (float_t)717.0,
    (float_t)718.0,
    (float_t)719.0,
    (float_t)720.0,
    (float_t)721.0,
    (float_t)722.0,
    (float_t)723.0,
    (float_t)724.0,
    (float_t)725.0,
    (float_t)726.0,
    (float_t)727.0,
    (float_t)728.0,
    (float_t)729.0,
    (float_t)730.0,
    (float_t)731.0,
    (float_t)732.0,
    (float_t)733.0,
    (float_t)734.0,
    (float_t)735.0,
    (float_t)736.0,
    (float_t)737.0,
    (float_t)738.0,
    (float_t)739.0,
    (float_t)740.0,
    (float_t)741.0,
    (float_t)742.0,
    (float_t)743.0,
    (float_t)744.0,
    (float_t)745.0,
    (float_t)746.0,
    (float_t)747.0,
    (float_t)748.0,
    (float_t)749.0,
    (float_t)750.0,
    (float_t)751.0,
    (float_t)752.0,
    (float_t)753.0,
    (float_t)754.0,
    (float_t)755.0,
    (float_t)756.0,
    (float_t)757.0,
    (float_t)758.0,
    (float_t)759.0,
    (float_t)760.0,
    (float_t)761.0,
    (float_t)762.0,
    (float_t)763.0,
    (float_t)764.0,
    (float_t)765.0,
    (float_t)766.0,
    (float_t)767.0,
    (float_t)768.0,
    (float_t)769.0,
    (float_t)770.0,
    (float_t)771.0,
    (float_t)772.0,
    (float_t)773.0,
    (float_t)774.0,
    (float_t)775.0,
    (float_t)776.0,
    (float_t)777.0,
    (float_t)778.0,
    (float_t)779.0,
    (float_t)780.0,
    (float_t)781.0,
    (float_t)782.0,
    (float_t)783.0,
    (float_t)784.0,
    (float_t)785.0,
    (float_t)786.0,
    (float_t)787.0,
    (float_t)788.0,
    (float_t)789.0,
    (float_t)790.0,
    (float_t)791.0,
    (float_t)792.0,
    (float_t)793.0,
    (float_t)794.0,
    (float_t)795.0,
    (float_t)796.0,
    (float_t)797.0,
    (float_t)798.0,
    (float_t)799.0,
    (float_t)800.0,
    (float_t)801.0,
    (float_t)802.0,
    (float_t)803.0,
    (float_t)804.0,
    (float_t)805.0,
    (float_t)806.0,
    (float_t)807.0,
    (float_t)808.0,
    (float_t)809.0,
    (float_t)810.0,
    (float_t)811.0,
    (float_t)812.0,
    (float_t)813.0,
    (float_t)814.0,
    (float_t)815.0,
    (float_t)816.0,
    (float_t)817.0,
    (float_t)818.0,
    (float_t)819.0,
    (float_t)820.0,
    (float_t)821.0,
    (float_t)822.0,
    (float_t)823.0,
    (float_t)824.0,
    (float_t)825.0,
    (float_t)826.0,
    (float_t)827.0,
    (float_t)828.0,
    (float_t)829.0,
    (float_t)830.0
};

static const float_t cie_x_bar[] = {
    (float_t)0.0001299 * (float_t)0.5,
    (float_t)0.000145847,
    (float_t)0.0001638021,
    (float_t)0.0001840037,
    (float_t)0.0002066902,
    (float_t)0.0002321,
    (float_t)0.000260728,
    (float_t)0.000293075,
    (float_t)0.000329388,
    (float_t)0.000369914,
    (float_t)0.0004149,
    (float_t)0.0004641587,
    (float_t)0.000518986,
    (float_t)0.000581854,
    (float_t)0.0006552347,
    (float_t)0.0007416,
    (float_t)0.0008450296,
    (float_t)0.0009645268,
    (float_t)0.001094949,
    (float_t)0.001231154,
    (float_t)0.001368,
    (float_t)0.00150205,
    (float_t)0.001642328,
    (float_t)0.001802382,
    (float_t)0.001995757,
    (float_t)0.002236,
    (float_t)0.002535385,
    (float_t)0.002892603,
    (float_t)0.003300829,
    (float_t)0.003753236,
    (float_t)0.004243,
    (float_t)0.004762389,
    (float_t)0.005330048,
    (float_t)0.005978712,
    (float_t)0.006741117,
    (float_t)0.00765,
    (float_t)0.008751373,
    (float_t)0.01002888,
    (float_t)0.0114217,
    (float_t)0.01286901,
    (float_t)0.01431,
    (float_t)0.01570443,
    (float_t)0.01714744,
    (float_t)0.01878122,
    (float_t)0.02074801,
    (float_t)0.02319,
    (float_t)0.02620736,
    (float_t)0.02978248,
    (float_t)0.03388092,
    (float_t)0.03846824,
    (float_t)0.04351,
    (float_t)0.0489956,
    (float_t)0.0550226,
    (float_t)0.0617188,
    (float_t)0.069212,
    (float_t)0.07763,
    (float_t)0.08695811,
    (float_t)0.09717672,
    (float_t)0.1084063,
    (float_t)0.1207672,
    (float_t)0.13438,
    (float_t)0.1493582,
    (float_t)0.1653957,
    (float_t)0.1819831,
    (float_t)0.198611,
    (float_t)0.21477,
    (float_t)0.2301868,
    (float_t)0.2448797,
    (float_t)0.2587773,
    (float_t)0.2718079,
    (float_t)0.2839,
    (float_t)0.2949438,
    (float_t)0.3048965,
    (float_t)0.3137873,
    (float_t)0.3216454,
    (float_t)0.3285,
    (float_t)0.3343513,
    (float_t)0.3392101,
    (float_t)0.3431213,
    (float_t)0.3461296,
    (float_t)0.34828,
    (float_t)0.3495999,
    (float_t)0.3501474,
    (float_t)0.350013,
    (float_t)0.349287,
    (float_t)0.34806,
    (float_t)0.3463733,
    (float_t)0.3442624,
    (float_t)0.3418088,
    (float_t)0.3390941,
    (float_t)0.3362,
    (float_t)0.3331977,
    (float_t)0.3300411,
    (float_t)0.3266357,
    (float_t)0.3228868,
    (float_t)0.3187,
    (float_t)0.3140251,
    (float_t)0.308884,
    (float_t)0.3032904,
    (float_t)0.2972579,
    (float_t)0.2908,
    (float_t)0.2839701,
    (float_t)0.2767214,
    (float_t)0.2689178,
    (float_t)0.2604227,
    (float_t)0.2511,
    (float_t)0.2408475,
    (float_t)0.2298512,
    (float_t)0.2184072,
    (float_t)0.2068115,
    (float_t)0.19536,
    (float_t)0.1842136,
    (float_t)0.1733273,
    (float_t)0.1626881,
    (float_t)0.1522833,
    (float_t)0.1421,
    (float_t)0.1321786,
    (float_t)0.1225696,
    (float_t)0.1132752,
    (float_t)0.1042979,
    (float_t)0.09564,
    (float_t)0.08729955,
    (float_t)0.07930804,
    (float_t)0.07171776,
    (float_t)0.06458099,
    (float_t)0.05795001,
    (float_t)0.05186211,
    (float_t)0.04628152,
    (float_t)0.04115088,
    (float_t)0.03641283,
    (float_t)0.03201,
    (float_t)0.0279172,
    (float_t)0.0241444,
    (float_t)0.020687,
    (float_t)0.0175404,
    (float_t)0.0147,
    (float_t)0.01216179,
    (float_t)0.00991996,
    (float_t)0.00796724,
    (float_t)0.006296346,
    (float_t)0.0049,
    (float_t)0.003777173,
    (float_t)0.00294532,
    (float_t)0.00242488,
    (float_t)0.002236293,
    (float_t)0.0024,
    (float_t)0.00292552,
    (float_t)0.00383656,
    (float_t)0.00517484,
    (float_t)0.00698208,
    (float_t)0.0093,
    (float_t)0.01214949,
    (float_t)0.01553588,
    (float_t)0.01947752,
    (float_t)0.02399277,
    (float_t)0.0291,
    (float_t)0.03481485,
    (float_t)0.04112016,
    (float_t)0.04798504,
    (float_t)0.05537861,
    (float_t)0.06327,
    (float_t)0.07163501,
    (float_t)0.08046224,
    (float_t)0.08973996,
    (float_t)0.09945645,
    (float_t)0.1096,
    (float_t)0.1201674,
    (float_t)0.1311145,
    (float_t)0.1423679,
    (float_t)0.1538542,
    (float_t)0.1655,
    (float_t)0.1772571,
    (float_t)0.18914,
    (float_t)0.2011694,
    (float_t)0.2133658,
    (float_t)0.2257499,
    (float_t)0.2383209,
    (float_t)0.2510668,
    (float_t)0.2639922,
    (float_t)0.2771017,
    (float_t)0.2904,
    (float_t)0.3038912,
    (float_t)0.3175726,
    (float_t)0.3314384,
    (float_t)0.3454828,
    (float_t)0.3597,
    (float_t)0.3740839,
    (float_t)0.3886396,
    (float_t)0.4033784,
    (float_t)0.4183115,
    (float_t)0.4334499,
    (float_t)0.4487953,
    (float_t)0.464336,
    (float_t)0.480064,
    (float_t)0.4959713,
    (float_t)0.5120501,
    (float_t)0.5282959,
    (float_t)0.5446916,
    (float_t)0.5612094,
    (float_t)0.5778215,
    (float_t)0.5945,
    (float_t)0.6112209,
    (float_t)0.6279758,
    (float_t)0.6447602,
    (float_t)0.6615697,
    (float_t)0.6784,
    (float_t)0.6952392,
    (float_t)0.7120586,
    (float_t)0.7288284,
    (float_t)0.7455188,
    (float_t)0.7621,
    (float_t)0.7785432,
    (float_t)0.7948256,
    (float_t)0.8109264,
    (float_t)0.8268248,
    (float_t)0.8425,
    (float_t)0.8579325,
    (float_t)0.8730816,
    (float_t)0.8878944,
    (float_t)0.9023181,
    (float_t)0.9163,
    (float_t)0.9297995,
    (float_t)0.9427984,
    (float_t)0.9552776,
    (float_t)0.9672179,
    (float_t)0.9786,
    (float_t)0.9893856,
    (float_t)0.9995488,
    (float_t)1.0090892,
    (float_t)1.0180064,
    (float_t)1.0263,
    (float_t)1.0339827,
    (float_t)1.040986,
    (float_t)1.047188,
    (float_t)1.0524667,
    (float_t)1.0567,
    (float_t)1.0597944,
    (float_t)1.0617992,
    (float_t)1.0628068,
    (float_t)1.0629096,
    (float_t)1.0622,
    (float_t)1.0607352,
    (float_t)1.0584436,
    (float_t)1.0552244,
    (float_t)1.0509768,
    (float_t)1.0456,
    (float_t)1.0390369,
    (float_t)1.0313608,
    (float_t)1.0226662,
    (float_t)1.0130477,
    (float_t)1.0026,
    (float_t)0.9913675,
    (float_t)0.9793314,
    (float_t)0.9664916,
    (float_t)0.9528479,
    (float_t)0.9384,
    (float_t)0.923194,
    (float_t)0.907244,
    (float_t)0.890502,
    (float_t)0.87292,
    (float_t)0.8544499,
    (float_t)0.835084,
    (float_t)0.814946,
    (float_t)0.794186,
    (float_t)0.772954,
    (float_t)0.7514,
    (float_t)0.7295836,
    (float_t)0.7075888,
    (float_t)0.6856022,
    (float_t)0.6638104,
    (float_t)0.6424,
    (float_t)0.6215149,
    (float_t)0.6011138,
    (float_t)0.5811052,
    (float_t)0.5613977,
    (float_t)0.5419,
    (float_t)0.5225995,
    (float_t)0.5035464,
    (float_t)0.4847436,
    (float_t)0.4661939,
    (float_t)0.4479,
    (float_t)0.4298613,
    (float_t)0.412098,
    (float_t)0.394644,
    (float_t)0.3775333,
    (float_t)0.3608,
    (float_t)0.3444563,
    (float_t)0.3285168,
    (float_t)0.3130192,
    (float_t)0.2980011,
    (float_t)0.2835,
    (float_t)0.2695448,
    (float_t)0.2561184,
    (float_t)0.2431896,
    (float_t)0.2307272,
    (float_t)0.2187,
    (float_t)0.2070971,
    (float_t)0.1959232,
    (float_t)0.1851708,
    (float_t)0.1748323,
    (float_t)0.1649,
    (float_t)0.1553667,
    (float_t)0.14623,
    (float_t)0.13749,
    (float_t)0.1291467,
    (float_t)0.1212,
    (float_t)0.1136397,
    (float_t)0.106465,
    (float_t)0.09969044,
    (float_t)0.09333061,
    (float_t)0.0874,
    (float_t)0.08190096,
    (float_t)0.07680428,
    (float_t)0.07207712,
    (float_t)0.06768664,
    (float_t)0.0636,
    (float_t)0.05980685,
    (float_t)0.05628216,
    (float_t)0.05297104,
    (float_t)0.04981861,
    (float_t)0.04677,
    (float_t)0.04378405,
    (float_t)0.04087536,
    (float_t)0.03807264,
    (float_t)0.03540461,
    (float_t)0.0329,
    (float_t)0.03056419,
    (float_t)0.02838056,
    (float_t)0.02634484,
    (float_t)0.02445275,
    (float_t)0.0227,
    (float_t)0.02108429,
    (float_t)0.01959988,
    (float_t)0.01823732,
    (float_t)0.01698717,
    (float_t)0.01584,
    (float_t)0.01479064,
    (float_t)0.01383132,
    (float_t)0.01294868,
    (float_t)0.0121292,
    (float_t)0.01135916,
    (float_t)0.01062935,
    (float_t)0.009938846,
    (float_t)0.009288422,
    (float_t)0.008678854,
    (float_t)0.008110916,
    (float_t)0.007582388,
    (float_t)0.007088746,
    (float_t)0.006627313,
    (float_t)0.006195408,
    (float_t)0.005790346,
    (float_t)0.005409826,
    (float_t)0.005052583,
    (float_t)0.004717512,
    (float_t)0.004403507,
    (float_t)0.004109457,
    (float_t)0.003833913,
    (float_t)0.003575748,
    (float_t)0.003334342,
    (float_t)0.003109075,
    (float_t)0.002899327,
    (float_t)0.002704348,
    (float_t)0.00252302,
    (float_t)0.002354168,
    (float_t)0.002196616,
    (float_t)0.00204919,
    (float_t)0.00191096,
    (float_t)0.001781438,
    (float_t)0.00166011,
    (float_t)0.001546459,
    (float_t)0.001439971,
    (float_t)0.001340042,
    (float_t)0.001246275,
    (float_t)0.001158471,
    (float_t)0.00107643,
    (float_t)0.0009999493,
    (float_t)0.0009287358,
    (float_t)0.0008624332,
    (float_t)0.0008007503,
    (float_t)0.000743396,
    (float_t)0.0006900786,
    (float_t)0.0006405156,
    (float_t)0.0005945021,
    (float_t)0.0005518646,
    (float_t)0.000512429,
    (float_t)0.0004760213,
    (float_t)0.0004424536,
    (float_t)0.0004115117,
    (float_t)0.0003829814,
    (float_t)0.0003566491,
    (float_t)0.0003323011,
    (float_t)0.0003097586,
    (float_t)0.0002888871,
    (float_t)0.0002695394,
    (float_t)0.0002515682,
    (float_t)0.0002348261,
    (float_t)0.000219171,
    (float_t)0.0002045258,
    (float_t)0.0001908405,
    (float_t)0.0001780654,
    (float_t)0.0001661505,
    (float_t)0.0001550236,
    (float_t)0.0001446219,
    (float_t)0.0001349098,
    (float_t)0.000125852,
    (float_t)0.000117413,
    (float_t)0.0001095515,
    (float_t)0.0001022245,
    (float_t)0.00009539445,
    (float_t)0.0000890239,
    (float_t)0.00008307527,
    (float_t)0.00007751269,
    (float_t)0.00007231304,
    (float_t)0.00006745778,
    (float_t)0.00006292844,
    (float_t)0.00005870652,
    (float_t)0.00005477028,
    (float_t)0.00005109918,
    (float_t)0.00004767654,
    (float_t)0.00004448567,
    (float_t)0.00004150994,
    (float_t)0.00003873324,
    (float_t)0.00003614203,
    (float_t)0.00003372352,
    (float_t)0.00003146487,
    (float_t)0.00002935326,
    (float_t)0.00002737573,
    (float_t)0.00002552433,
    (float_t)0.00002379376,
    (float_t)0.0000221787,
    (float_t)0.00002067383,
    (float_t)0.00001927226,
    (float_t)0.0000179664,
    (float_t)0.00001674991,
    (float_t)0.00001561648,
    (float_t)0.00001455977,
    (float_t)0.00001357387,
    (float_t)0.00001265436,
    (float_t)0.00001179723,
    (float_t)0.00001099844,
    (float_t)0.00001025398,
    (float_t)0.000009559646,
    (float_t)0.000008912044,
    (float_t)0.000008308358,
    (float_t)0.000007745769,
    (float_t)0.000007221456,
    (float_t)0.000006732475,
    (float_t)0.000006276423,
    (float_t)0.000005851304,
    (float_t)0.000005455118,
    (float_t)0.000005085868,
    (float_t)0.000004741466,
    (float_t)0.000004420236,
    (float_t)0.000004120783,
    (float_t)0.000003841716,
    (float_t)0.000003581652,
    (float_t)0.000003339127,
    (float_t)0.000003112949,
    (float_t)0.000002902121,
    (float_t)0.000002705645,
    (float_t)0.000002522525,
    (float_t)0.000002351726,
    (float_t)0.000002192415,
    (float_t)0.000002043902,
    (float_t)0.000001905497,
    (float_t)0.000001776509,
    (float_t)0.000001656215,
    (float_t)0.000001544022,
    (float_t)0.00000143944,
    (float_t)0.000001341977,
    (float_t)0.000001251141 * (float_t)0.5
};

static const float_t cie_y_bar[] = {
    (float_t)0.000003917 * (float_t)0.5,
    (float_t)0.000004393581,
    (float_t)0.000004929604,
    (float_t)0.000005532136,
    (float_t)0.000006208245,
    (float_t)0.000006965,
    (float_t)0.000007813219,
    (float_t)0.000008767336,
    (float_t)0.000009839844,
    (float_t)0.00001104323,
    (float_t)0.00001239,
    (float_t)0.00001388641,
    (float_t)0.00001555728,
    (float_t)0.00001744296,
    (float_t)0.00001958375,
    (float_t)0.00002202,
    (float_t)0.00002483965,
    (float_t)0.00002804126,
    (float_t)0.00003153104,
    (float_t)0.00003521521,
    (float_t)0.000039,
    (float_t)0.0000428264,
    (float_t)0.0000469146,
    (float_t)0.0000515896,
    (float_t)0.0000571764,
    (float_t)0.000064,
    (float_t)0.00007234421,
    (float_t)0.00008221224,
    (float_t)0.00009350816,
    (float_t)0.0001061361,
    (float_t)0.00012,
    (float_t)0.000134984,
    (float_t)0.000151492,
    (float_t)0.000170208,
    (float_t)0.000191816,
    (float_t)0.000217,
    (float_t)0.0002469067,
    (float_t)0.00028124,
    (float_t)0.00031852,
    (float_t)0.0003572667,
    (float_t)0.000396,
    (float_t)0.0004337147,
    (float_t)0.000473024,
    (float_t)0.000517876,
    (float_t)0.0005722187,
    (float_t)0.00064,
    (float_t)0.00072456,
    (float_t)0.0008255,
    (float_t)0.00094116,
    (float_t)0.00106988,
    (float_t)0.00121,
    (float_t)0.001362091,
    (float_t)0.001530752,
    (float_t)0.001720368,
    (float_t)0.001935323,
    (float_t)0.00218,
    (float_t)0.0024548,
    (float_t)0.002764,
    (float_t)0.0031178,
    (float_t)0.0035264,
    (float_t)0.004,
    (float_t)0.00454624,
    (float_t)0.00515932,
    (float_t)0.00582928,
    (float_t)0.00654616,
    (float_t)0.0073,
    (float_t)0.008086507,
    (float_t)0.00890872,
    (float_t)0.00976768,
    (float_t)0.01066443,
    (float_t)0.0116,
    (float_t)0.01257317,
    (float_t)0.01358272,
    (float_t)0.01462968,
    (float_t)0.01571509,
    (float_t)0.01684,
    (float_t)0.01800736,
    (float_t)0.01921448,
    (float_t)0.02045392,
    (float_t)0.02171824,
    (float_t)0.023,
    (float_t)0.02429461,
    (float_t)0.02561024,
    (float_t)0.02695857,
    (float_t)0.02835125,
    (float_t)0.0298,
    (float_t)0.03131083,
    (float_t)0.03288368,
    (float_t)0.03452112,
    (float_t)0.03622571,
    (float_t)0.038,
    (float_t)0.03984667,
    (float_t)0.041768,
    (float_t)0.043766,
    (float_t)0.04584267,
    (float_t)0.048,
    (float_t)0.05024368,
    (float_t)0.05257304,
    (float_t)0.05498056,
    (float_t)0.05745872,
    (float_t)0.06,
    (float_t)0.06260197,
    (float_t)0.06527752,
    (float_t)0.06804208,
    (float_t)0.07091109,
    (float_t)0.0739,
    (float_t)0.077016,
    (float_t)0.0802664,
    (float_t)0.0836668,
    (float_t)0.0872328,
    (float_t)0.09098,
    (float_t)0.09491755,
    (float_t)0.09904584,
    (float_t)0.1033674,
    (float_t)0.1078846,
    (float_t)0.1126,
    (float_t)0.117532,
    (float_t)0.1226744,
    (float_t)0.1279928,
    (float_t)0.1334528,
    (float_t)0.13902,
    (float_t)0.1446764,
    (float_t)0.1504693,
    (float_t)0.1564619,
    (float_t)0.1627177,
    (float_t)0.1693,
    (float_t)0.1762431,
    (float_t)0.1835581,
    (float_t)0.1912735,
    (float_t)0.199418,
    (float_t)0.20802,
    (float_t)0.2171199,
    (float_t)0.2267345,
    (float_t)0.2368571,
    (float_t)0.2474812,
    (float_t)0.2586,
    (float_t)0.2701849,
    (float_t)0.2822939,
    (float_t)0.2950505,
    (float_t)0.308578,
    (float_t)0.323,
    (float_t)0.3384021,
    (float_t)0.3546858,
    (float_t)0.3716986,
    (float_t)0.3892875,
    (float_t)0.4073,
    (float_t)0.4256299,
    (float_t)0.4443096,
    (float_t)0.4633944,
    (float_t)0.4829395,
    (float_t)0.503,
    (float_t)0.5235693,
    (float_t)0.544512,
    (float_t)0.56569,
    (float_t)0.5869653,
    (float_t)0.6082,
    (float_t)0.6293456,
    (float_t)0.6503068,
    (float_t)0.6708752,
    (float_t)0.6908424,
    (float_t)0.71,
    (float_t)0.7281852,
    (float_t)0.7454636,
    (float_t)0.7619694,
    (float_t)0.7778368,
    (float_t)0.7932,
    (float_t)0.8081104,
    (float_t)0.8224962,
    (float_t)0.8363068,
    (float_t)0.8494916,
    (float_t)0.862,
    (float_t)0.8738108,
    (float_t)0.8849624,
    (float_t)0.8954936,
    (float_t)0.9054432,
    (float_t)0.9148501,
    (float_t)0.9237348,
    (float_t)0.9320924,
    (float_t)0.9399226,
    (float_t)0.9472252,
    (float_t)0.954,
    (float_t)0.9602561,
    (float_t)0.9660074,
    (float_t)0.9712606,
    (float_t)0.9760225,
    (float_t)0.9803,
    (float_t)0.9840924,
    (float_t)0.9874182,
    (float_t)0.9903128,
    (float_t)0.9928116,
    (float_t)0.9949501,
    (float_t)0.9967108,
    (float_t)0.9980983,
    (float_t)0.999112,
    (float_t)0.9997482,
    (float_t)1.0,
    (float_t)0.9998567,
    (float_t)0.9993046,
    (float_t)0.9983255,
    (float_t)0.9968987,
    (float_t)0.995,
    (float_t)0.9926005,
    (float_t)0.9897426,
    (float_t)0.9864444,
    (float_t)0.9827241,
    (float_t)0.9786,
    (float_t)0.9740837,
    (float_t)0.9691712,
    (float_t)0.9638568,
    (float_t)0.9581349,
    (float_t)0.952,
    (float_t)0.9454504,
    (float_t)0.9384992,
    (float_t)0.9311628,
    (float_t)0.9234576,
    (float_t)0.9154,
    (float_t)0.9070064,
    (float_t)0.8982772,
    (float_t)0.8892048,
    (float_t)0.8797816,
    (float_t)0.87,
    (float_t)0.8598613,
    (float_t)0.849392,
    (float_t)0.838622,
    (float_t)0.8275813,
    (float_t)0.8163,
    (float_t)0.8047947,
    (float_t)0.793082,
    (float_t)0.781192,
    (float_t)0.7691547,
    (float_t)0.757,
    (float_t)0.7447541,
    (float_t)0.7324224,
    (float_t)0.7200036,
    (float_t)0.7074965,
    (float_t)0.6949,
    (float_t)0.6822192,
    (float_t)0.6694716,
    (float_t)0.6566744,
    (float_t)0.6438448,
    (float_t)0.631,
    (float_t)0.6181555,
    (float_t)0.6053144,
    (float_t)0.5924756,
    (float_t)0.5796379,
    (float_t)0.5668,
    (float_t)0.5539611,
    (float_t)0.5411372,
    (float_t)0.5283528,
    (float_t)0.5156323,
    (float_t)0.503,
    (float_t)0.4904688,
    (float_t)0.4780304,
    (float_t)0.4656776,
    (float_t)0.4534032,
    (float_t)0.4412,
    (float_t)0.42908,
    (float_t)0.417036,
    (float_t)0.405032,
    (float_t)0.393032,
    (float_t)0.381,
    (float_t)0.3689184,
    (float_t)0.3568272,
    (float_t)0.3447768,
    (float_t)0.3328176,
    (float_t)0.321,
    (float_t)0.3093381,
    (float_t)0.2978504,
    (float_t)0.2865936,
    (float_t)0.2756245,
    (float_t)0.265,
    (float_t)0.2547632,
    (float_t)0.2448896,
    (float_t)0.2353344,
    (float_t)0.2260528,
    (float_t)0.217,
    (float_t)0.2081616,
    (float_t)0.1995488,
    (float_t)0.1911552,
    (float_t)0.1829744,
    (float_t)0.175,
    (float_t)0.1672235,
    (float_t)0.1596464,
    (float_t)0.1522776,
    (float_t)0.1451259,
    (float_t)0.1382,
    (float_t)0.1315003,
    (float_t)0.1250248,
    (float_t)0.1187792,
    (float_t)0.1127691,
    (float_t)0.107,
    (float_t)0.1014762,
    (float_t)0.09618864,
    (float_t)0.09112296,
    (float_t)0.08626485,
    (float_t)0.0816,
    (float_t)0.07712064,
    (float_t)0.07282552,
    (float_t)0.06871008,
    (float_t)0.06476976,
    (float_t)0.061,
    (float_t)0.05739621,
    (float_t)0.05395504,
    (float_t)0.05067376,
    (float_t)0.04754965,
    (float_t)0.04458,
    (float_t)0.04175872,
    (float_t)0.03908496,
    (float_t)0.03656384,
    (float_t)0.03420048,
    (float_t)0.032,
    (float_t)0.02996261,
    (float_t)0.02807664,
    (float_t)0.02632936,
    (float_t)0.02470805,
    (float_t)0.0232,
    (float_t)0.02180077,
    (float_t)0.02050112,
    (float_t)0.01928108,
    (float_t)0.01812069,
    (float_t)0.017,
    (float_t)0.01590379,
    (float_t)0.01483718,
    (float_t)0.01381068,
    (float_t)0.01283478,
    (float_t)0.01192,
    (float_t)0.01106831,
    (float_t)0.01027339,
    (float_t)0.009533311,
    (float_t)0.008846157,
    (float_t)0.00821,
    (float_t)0.007623781,
    (float_t)0.007085424,
    (float_t)0.006591476,
    (float_t)0.006138485,
    (float_t)0.005723,
    (float_t)0.005343059,
    (float_t)0.004995796,
    (float_t)0.004676404,
    (float_t)0.004380075,
    (float_t)0.004102,
    (float_t)0.003838453,
    (float_t)0.003589099,
    (float_t)0.003354219,
    (float_t)0.003134093,
    (float_t)0.002929,
    (float_t)0.002738139,
    (float_t)0.002559876,
    (float_t)0.002393244,
    (float_t)0.002237275,
    (float_t)0.002091,
    (float_t)0.001953587,
    (float_t)0.00182458,
    (float_t)0.00170358,
    (float_t)0.001590187,
    (float_t)0.001484,
    (float_t)0.001384496,
    (float_t)0.001291268,
    (float_t)0.001204092,
    (float_t)0.001122744,
    (float_t)0.001047,
    (float_t)0.0009765896,
    (float_t)0.0009111088,
    (float_t)0.0008501332,
    (float_t)0.0007932384,
    (float_t)0.00074,
    (float_t)0.0006900827,
    (float_t)0.00064331,
    (float_t)0.000599496,
    (float_t)0.0005584547,
    (float_t)0.00052,
    (float_t)0.0004839136,
    (float_t)0.0004500528,
    (float_t)0.0004183452,
    (float_t)0.0003887184,
    (float_t)0.0003611,
    (float_t)0.0003353835,
    (float_t)0.0003114404,
    (float_t)0.0002891656,
    (float_t)0.0002684539,
    (float_t)0.0002492,
    (float_t)0.0002313019,
    (float_t)0.0002146856,
    (float_t)0.0001992884,
    (float_t)0.0001850475,
    (float_t)0.0001719,
    (float_t)0.0001597781,
    (float_t)0.0001486044,
    (float_t)0.0001383016,
    (float_t)0.0001287925,
    (float_t)0.00012,
    (float_t)0.0001118595,
    (float_t)0.0001043224,
    (float_t)0.0000973356,
    (float_t)0.00009084587,
    (float_t)0.0000848,
    (float_t)0.00007914667,
    (float_t)0.000073858,
    (float_t)0.000068916,
    (float_t)0.00006430267,
    (float_t)0.00006,
    (float_t)0.00005598187,
    (float_t)0.0000522256,
    (float_t)0.0000487184,
    (float_t)0.00004544747,
    (float_t)0.0000424,
    (float_t)0.00003956104,
    (float_t)0.00003691512,
    (float_t)0.00003444868,
    (float_t)0.00003214816,
    (float_t)0.00003,
    (float_t)0.00002799125,
    (float_t)0.00002611356,
    (float_t)0.00002436024,
    (float_t)0.00002272461,
    (float_t)0.0000212,
    (float_t)0.00001977855,
    (float_t)0.00001845285,
    (float_t)0.00001721687,
    (float_t)0.00001606459,
    (float_t)0.00001499,
    (float_t)0.00001398728,
    (float_t)0.00001305155,
    (float_t)0.00001217818,
    (float_t)0.00001136254,
    (float_t)0.0000106,
    (float_t)0.000009885877,
    (float_t)0.000009217304,
    (float_t)0.000008592362,
    (float_t)0.000008009133,
    (float_t)0.0000074657,
    (float_t)0.000006959567,
    (float_t)0.000006487995,
    (float_t)0.000006048699,
    (float_t)0.000005639396,
    (float_t)0.0000052578,
    (float_t)0.000004901771,
    (float_t)0.00000456972,
    (float_t)0.000004260194,
    (float_t)0.000003971739,
    (float_t)0.0000037029,
    (float_t)0.000003452163,
    (float_t)0.000003218302,
    (float_t)0.0000030003,
    (float_t)0.000002797139,
    (float_t)0.0000026078,
    (float_t)0.00000243122,
    (float_t)0.000002266531,
    (float_t)0.000002113013,
    (float_t)0.000001969943,
    (float_t)0.0000018366,
    (float_t)0.00000171223,
    (float_t)0.000001596228,
    (float_t)0.00000148809,
    (float_t)0.000001387314,
    (float_t)0.0000012934,
    (float_t)0.00000120582,
    (float_t)0.000001124143,
    (float_t)0.000001048009,
    (float_t)0.0000009770578,
    (float_t)0.00000091093,
    (float_t)0.0000008492513,
    (float_t)0.0000007917212,
    (float_t)0.0000007380904,
    (float_t)0.0000006881098,
    (float_t)0.00000064153,
    (float_t)0.0000005980895,
    (float_t)0.0000005575746,
    (float_t)0.000000519808,
    (float_t)0.0000004846123,
    (float_t)0.00000045181 * (float_t)0.5
};

static const float_t cie_z_bar[] = {
    (float_t)0.0006061 * (float_t)0.5,
    (float_t)0.0006808792,
    (float_t)0.0007651456,
    (float_t)0.0008600124,
    (float_t)0.0009665928,
    (float_t)0.001086,
    (float_t)0.001220586,
    (float_t)0.001372729,
    (float_t)0.001543579,
    (float_t)0.001734286,
    (float_t)0.001946,
    (float_t)0.002177777,
    (float_t)0.002435809,
    (float_t)0.002731953,
    (float_t)0.003078064,
    (float_t)0.003486,
    (float_t)0.003975227,
    (float_t)0.00454088,
    (float_t)0.00515832,
    (float_t)0.005802907,
    (float_t)0.006450001,
    (float_t)0.007083216,
    (float_t)0.007745488,
    (float_t)0.008501152,
    (float_t)0.009414544,
    (float_t)0.01054999,
    (float_t)0.0119658,
    (float_t)0.01365587,
    (float_t)0.01558805,
    (float_t)0.01773015,
    (float_t)0.02005001,
    (float_t)0.02251136,
    (float_t)0.02520288,
    (float_t)0.02827972,
    (float_t)0.03189704,
    (float_t)0.03621,
    (float_t)0.04143771,
    (float_t)0.04750372,
    (float_t)0.05411988,
    (float_t)0.06099803,
    (float_t)0.06785001,
    (float_t)0.07448632,
    (float_t)0.08136156,
    (float_t)0.08915364,
    (float_t)0.09854048,
    (float_t)0.1102,
    (float_t)0.1246133,
    (float_t)0.1417017,
    (float_t)0.1613035,
    (float_t)0.1832568,
    (float_t)0.2074,
    (float_t)0.2336921,
    (float_t)0.2626114,
    (float_t)0.2947746,
    (float_t)0.3307985,
    (float_t)0.3713,
    (float_t)0.4162091,
    (float_t)0.4654642,
    (float_t)0.5196948,
    (float_t)0.5795303,
    (float_t)0.6456,
    (float_t)0.7184838,
    (float_t)0.7967133,
    (float_t)0.8778459,
    (float_t)0.959439,
    (float_t)1.0390501,
    (float_t)1.1153673,
    (float_t)1.1884971,
    (float_t)1.2581233,
    (float_t)1.3239296,
    (float_t)1.3856,
    (float_t)1.4426352,
    (float_t)1.4948035,
    (float_t)1.5421903,
    (float_t)1.5848807,
    (float_t)1.62296,
    (float_t)1.6564048,
    (float_t)1.6852959,
    (float_t)1.7098745,
    (float_t)1.7303821,
    (float_t)1.74706,
    (float_t)1.7600446,
    (float_t)1.7696233,
    (float_t)1.7762637,
    (float_t)1.7804334,
    (float_t)1.7826,
    (float_t)1.7829682,
    (float_t)1.7816998,
    (float_t)1.7791982,
    (float_t)1.7758671,
    (float_t)1.77211,
    (float_t)1.7682589,
    (float_t)1.764039,
    (float_t)1.7589438,
    (float_t)1.7524663,
    (float_t)1.7441,
    (float_t)1.7335595,
    (float_t)1.7208581,
    (float_t)1.7059369,
    (float_t)1.6887372,
    (float_t)1.6692,
    (float_t)1.6475287,
    (float_t)1.6234127,
    (float_t)1.5960223,
    (float_t)1.564528,
    (float_t)1.5281,
    (float_t)1.4861114,
    (float_t)1.4395215,
    (float_t)1.3898799,
    (float_t)1.3387362,
    (float_t)1.28764,
    (float_t)1.2374223,
    (float_t)1.1878243,
    (float_t)1.1387611,
    (float_t)1.090148,
    (float_t)1.0419,
    (float_t)0.9941976,
    (float_t)0.9473473,
    (float_t)0.9014531,
    (float_t)0.8566193,
    (float_t)0.8129501,
    (float_t)0.7705173,
    (float_t)0.7294448,
    (float_t)0.6899136,
    (float_t)0.6521049,
    (float_t)0.6162,
    (float_t)0.5823286,
    (float_t)0.5504162,
    (float_t)0.5203376,
    (float_t)0.4919673,
    (float_t)0.46518,
    (float_t)0.4399246,
    (float_t)0.4161836,
    (float_t)0.3938822,
    (float_t)0.3729459,
    (float_t)0.3533,
    (float_t)0.3348578,
    (float_t)0.3175521,
    (float_t)0.3013375,
    (float_t)0.2861686,
    (float_t)0.272,
    (float_t)0.2588171,
    (float_t)0.2464838,
    (float_t)0.2347718,
    (float_t)0.2234533,
    (float_t)0.2123,
    (float_t)0.2011692,
    (float_t)0.1901196,
    (float_t)0.1792254,
    (float_t)0.1685608,
    (float_t)0.1582,
    (float_t)0.1481383,
    (float_t)0.1383758,
    (float_t)0.1289942,
    (float_t)0.1200751,
    (float_t)0.1117,
    (float_t)0.1039048,
    (float_t)0.09666748,
    (float_t)0.08998272,
    (float_t)0.08384531,
    (float_t)0.07824999,
    (float_t)0.07320899,
    (float_t)0.06867816,
    (float_t)0.06456784,
    (float_t)0.06078835,
    (float_t)0.05725001,
    (float_t)0.05390435,
    (float_t)0.05074664,
    (float_t)0.04775276,
    (float_t)0.04489859,
    (float_t)0.04216,
    (float_t)0.03950728,
    (float_t)0.03693564,
    (float_t)0.03445836,
    (float_t)0.03208872,
    (float_t)0.02984,
    (float_t)0.02771181,
    (float_t)0.02569444,
    (float_t)0.02378716,
    (float_t)0.02198925,
    (float_t)0.0203,
    (float_t)0.01871805,
    (float_t)0.01724036,
    (float_t)0.01586364,
    (float_t)0.01458461,
    (float_t)0.0134,
    (float_t)0.01230723,
    (float_t)0.01130188,
    (float_t)0.01037792,
    (float_t)0.009529306,
    (float_t)0.008749999,
    (float_t)0.0080352,
    (float_t)0.0073816,
    (float_t)0.0067854,
    (float_t)0.0062428,
    (float_t)0.005749999,
    (float_t)0.0053036,
    (float_t)0.0048998,
    (float_t)0.0045342,
    (float_t)0.0042024,
    (float_t)0.0039,
    (float_t)0.0036232,
    (float_t)0.0033706,
    (float_t)0.0031414,
    (float_t)0.0029348,
    (float_t)0.002749999,
    (float_t)0.0025852,
    (float_t)0.0024386,
    (float_t)0.0023094,
    (float_t)0.0021968,
    (float_t)0.0021,
    (float_t)0.002017733,
    (float_t)0.0019482,
    (float_t)0.0018898,
    (float_t)0.001840933,
    (float_t)0.0018,
    (float_t)0.001766267,
    (float_t)0.0017378,
    (float_t)0.0017112,
    (float_t)0.001683067,
    (float_t)0.001650001,
    (float_t)0.001610133,
    (float_t)0.0015644,
    (float_t)0.0015136,
    (float_t)0.001458533,
    (float_t)0.0014,
    (float_t)0.001336667,
    (float_t)0.00127,
    (float_t)0.001205,
    (float_t)0.001146667,
    (float_t)0.0011,
    (float_t)0.0010688,
    (float_t)0.0010494,
    (float_t)0.0010356,
    (float_t)0.0010212,
    (float_t)0.001,
    (float_t)0.00096864,
    (float_t)0.00092992,
    (float_t)0.00088688,
    (float_t)0.00084256,
    (float_t)0.0008,
    (float_t)0.00076096,
    (float_t)0.00072368,
    (float_t)0.00068592,
    (float_t)0.00064544,
    (float_t)0.0006,
    (float_t)0.0005478667,
    (float_t)0.0004916,
    (float_t)0.0004354,
    (float_t)0.0003834667,
    (float_t)0.00034,
    (float_t)0.0003072533,
    (float_t)0.00028316,
    (float_t)0.00026544,
    (float_t)0.0002518133,
    (float_t)0.00024,
    (float_t)0.0002295467,
    (float_t)0.00022064,
    (float_t)0.00021196,
    (float_t)0.0002021867,
    (float_t)0.00019,
    (float_t)0.0001742133,
    (float_t)0.00015564,
    (float_t)0.00013596,
    (float_t)0.0001168533,
    (float_t)0.0001,
    (float_t)0.00008613333,
    (float_t)0.0000746,
    (float_t)0.000065,
    (float_t)0.00005693333,
    (float_t)0.00004999999,
    (float_t)0.00004416,
    (float_t)0.00003948,
    (float_t)0.00003572,
    (float_t)0.00003264,
    (float_t)0.00003,
    (float_t)0.00002765333,
    (float_t)0.00002556,
    (float_t)0.00002364,
    (float_t)0.00002181333,
    (float_t)0.00002,
    (float_t)0.00001813333,
    (float_t)0.0000162,
    (float_t)0.0000142,
    (float_t)0.00001213333,
    (float_t)0.00001,
    (float_t)0.000007733333,
    (float_t)0.0000054,
    (float_t)0.0000032,
    (float_t)0.000001333333,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0,
    (float_t)0.0 * (float_t)0.5
};

const static float_t cie_y_integral =
    (float_t)106.85691491676691100565221859142184257507324218750;

//
// Static Functions
//

ISTATUS
CieColorIntegratorComputeSpectrumColor(
    _In_ const void *context,
    _In_opt_ PCSPECTRUM spectrum,
    _Out_ PCOLOR3 color
    )
{
    float_t values[3] = { (float_t)0.0, (float_t)0.0, (float_t)0.0 };

    // The values of cie_x_bar, cie_y_bar, and cie_z_bar have been adjusted
    // so that this computes the riemann sum using the trapezoidal rule.
    for (uint16_t i = 0; i < NUM_CIE_SAMPLES; i++)
    {
        float_t intensity;
        ISTATUS status = SpectrumSample(spectrum,
                                        cie_wavelengths[i],
                                        &intensity);

        if (status != ISTATUS_SUCCESS)
        {
            return status;
        }

        values[0] = fma(intensity, cie_x_bar[i], values[0]);
        values[1] = fma(intensity, cie_y_bar[i], values[1]);
        values[2] = fma(intensity, cie_z_bar[i], values[2]);
    }

    *color = ColorCreate(COLOR_SPACE_XYZ, values);

    return ISTATUS_SUCCESS;
}

ISTATUS
CieColorIntegratorComputeReflectiveSpectrumColor(
    _In_ const void *context,
    _In_opt_ PCSPECTRUM spectrum,
    _Out_ PCOLOR3 color
    )
{
    float_t values[3] = { (float_t)0.0, (float_t)0.0, (float_t)0.0 };

    // The values of cie_x_bar, cie_y_bar, and cie_z_bar have been adjusted
    // so that this computes the riemann sum using the trapezoidal rule.
    for (uint16_t i = 0; i < NUM_CIE_SAMPLES; i++)
    {
        float_t intensity;
        ISTATUS status = SpectrumSample(spectrum,
                                        cie_wavelengths[i],
                                        &intensity);

        if (status != ISTATUS_SUCCESS)
        {
            return status;
        }

        values[0] = fma(intensity, cie_x_bar[i], values[0]);
        values[1] = fma(intensity, cie_y_bar[i], values[1]);
        values[2] = fma(intensity, cie_z_bar[i], values[2]);
    }

    values[0] /= cie_y_integral;
    values[1] /= cie_y_integral;
    values[2] /= cie_y_integral;

    *color = ColorCreate(COLOR_SPACE_XYZ, values);

    return ISTATUS_SUCCESS;
}

ISTATUS
CieColorIntegratorComputeReflectorColor(
    _In_ const void *context,
    _In_opt_ PCREFLECTOR reflector,
    _Out_ PCOLOR3 color
    )
{
    float_t values[3] = { (float_t)0.0, (float_t)0.0, (float_t)0.0 };

    // The values of cie_x_bar, cie_y_bar, and cie_z_bar have been adjusted
    // so that this computes the riemann sum using the trapezoidal rule.
    for (uint16_t i = 0; i < NUM_CIE_SAMPLES; i++)
    {
        float_t intensity;
        ISTATUS status = ReflectorReflect(reflector,
                                          cie_wavelengths[i],
                                          &intensity);

        if (status != ISTATUS_SUCCESS)
        {
            return status;
        }

        values[0] = fma(intensity, cie_x_bar[i], values[0]);
        values[1] = fma(intensity, cie_y_bar[i], values[1]);
        values[2] = fma(intensity, cie_z_bar[i], values[2]);
    }

    values[0] /= cie_y_integral;
    values[1] /= cie_y_integral;
    values[2] /= cie_y_integral;

    *color = ColorCreate(COLOR_SPACE_XYZ, values);

    return ISTATUS_SUCCESS;
}

//
// Static Data
//

static const COLOR_INTEGRATOR_VTABLE cie_color_reflective_integrator_vtable = {
    CieColorIntegratorComputeReflectiveSpectrumColor,
    CieColorIntegratorComputeReflectorColor,
    NULL
};

static const COLOR_INTEGRATOR_VTABLE cie_color_integrator_vtable = {
    CieColorIntegratorComputeSpectrumColor,
    CieColorIntegratorComputeReflectorColor,
    NULL
};

//
// Functions
//

ISTATUS
CieColorIntegratorAllocate(
    _In_ bool always_compute_reflective,
    _Out_ PCOLOR_INTEGRATOR *color_integrator
    )
{
    if (color_integrator == NULL)
    {
        return ISTATUS_INVALID_ARGUMENT_01;
    }

    PCCOLOR_INTEGRATOR_VTABLE vtable;
    if (always_compute_reflective)
    {
        vtable = &cie_color_reflective_integrator_vtable;
    }
    else
    {
        vtable = &cie_color_integrator_vtable;
    }

    ISTATUS status =
        ColorIntegratorAllocate(vtable,
                                NULL,
                                0,
                                0,
                                color_integrator);

    return status;
}